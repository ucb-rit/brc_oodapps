<%-
  ppn = num_cores.blank? ? 20 : num_cores.to_i
  gpu = num_gpus.blank? ? 1 : num_gpus.to_i
  
  case gpu
  when 1
       tasks = 2
  when 2
       tasks = 4
  when 3 
       tasks = 6
  when 4 
       tasks = 8 
  end

  if slurm_partition.include?("gpu")
     node_type = "GPU"
  else 
     node_type = "CPU"
  end 
  
  case node_type
  when "CPU"
    slurm_args = [ "--nodes", "#{num_cpu}", "--ntasks", "#{ppn}", "--time", "#{num_hours}", "--partition", "#{slurm_partition}", "--qos", "#{qos_name}", "--job-name", "#{job_name}", "--account", "#{slurm_account}"]
  when "GPU"
    slurm_args = [ "--nodes", "#{num_cpu}", "--partition", "#{slurm_partition}", "--time", "#{num_hours}", "--qos", "#{qos_name}", "--job-name", "#{job_name}", "--account", "#{slurm_account}", "--gres", "gpu:#{gpu}", "--ntasks", "#{tasks}"]
    
  end
%>
---
batch_connect:
  template: vnc
script:
  native:
  <%- slurm_args.each do |arg| %>
    - "<%= arg %>"
  <%- end %>
